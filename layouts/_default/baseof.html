<!DOCTYPE html>
<html lang="{{ site.LanguageCode | default site.Language.Lang  }}" {{- with partialCached "func/GetLanguageDirection" "GetLanguageDirection" }} dir="{{ . }}" {{- end }}>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    {{/* Enhanced title with better SEO */}}
    <title>
      {{- if .IsPage -}}
        {{ .Title }} | {{ .Site.Title }}
      {{- else if .IsHome -}}
        {{ .Site.Title }} - {{ .Site.Params.description }}
      {{- else -}}
        {{ .Title }} | {{ .Site.Title }}
      {{- end -}}
    </title>
    
    {{/* Enhanced meta description */}}
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{if .IsPage}}{{ .Summary }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end }}">
    
    {{/* Additional SEO meta tags */}}
    <meta name="author" content="Prabeesh Keezhathra">
    <meta name="keywords" content="{{ with .Params.keywords }}{{ delimit . ", " }}{{ else }}{{ with .Site.Params.keywords }}{{ delimit . ", " }}{{ end }}{{ end }}">
    <meta name="robots" content="{{ if .Params.noindex }}noindex,nofollow{{ else }}index,follow{{ end }}">
    
    {{/* Canonical URL */}}
    <link rel="canonical" href="{{ .Permalink }}">
    
    {{ hugo.Generator }}
    
    {{/* Production environment check */}}
    {{ $production := eq (getenv "HUGO_ENV") "production" | or (eq site.Params.env "production") }}
    {{ $public := not .Params.private }}
    
    {{/* Enhanced structured data for blog posts */}}
    {{ if .IsPage }}
      <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "BlogPosting",
          "headline": "{{ .Title }}",
          "description": "{{ .Description }}",
          "datePublished": "{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }}",
          "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
          "author": {
            "@type": "Person",
            "name": "Prabeesh Keezhathra",
            "url": "https://blog.prabeeshk.com/about"
          },
          "publisher": {
            "@type": "Organization",
            "name": "{{ .Site.Title }}",
            "logo": {
              "@type": "ImageObject",
              "url": "{{ .Site.BaseURL }}images/logo.png"
            }
          },
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ .Permalink }}"
          },
          "image": "{{ with .Params.featured_image }}{{ . }}{{ else }}{{ .Site.BaseURL }}images/default-featured.jpg{{ end }}",
          "wordCount": "{{ .WordCount }}",
          "timeRequired": "PT{{ .ReadingTime }}M"
        }
      </script>
      
      {{/* Enhanced Open Graph tags */}}
      <meta property="og:type" content="article">
      <meta property="og:title" content="{{ .Title }}">
      <meta property="og:description" content="{{ .Description }}">
      <meta property="og:url" content="{{ .Permalink }}">
      <meta property="og:site_name" content="{{ .Site.Title }}">
      <meta property="og:image" content="{{ with .Params.featured_image }}{{ . }}{{ else }}{{ .Site.BaseURL }}images/default-featured.jpg{{ end }}">
      <meta property="og:image:width" content="1200">
      <meta property="og:image:height" content="630">
      <meta property="article:published_time" content="{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }}">
      <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
      <meta property="article:author" content="Prabeesh Keezhathra">
      {{ with .Params.tags }}
        {{ range . }}
        <meta property="article:tag" content="{{ . }}">
        {{ end }}
      {{ end }}
    {{ else }}
      {{/* Open Graph for non-article pages */}}
      <meta property="og:type" content="website">
      <meta property="og:title" content="{{ .Title }}">
      <meta property="og:description" content="{{ .Description }}">
      <meta property="og:url" content="{{ .Permalink }}">
      <meta property="og:site_name" content="{{ .Site.Title }}">
    {{ end }}
    
    {{/* Enhanced Twitter Card tags */}}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="{{ .Site.Params.twitter_site }}">
    <meta name="twitter:creator" content="{{ .Site.Params.twitter_creator }}">
    <meta name="twitter:title" content="{{ .Title }}">
    <meta name="twitter:description" content="{{ .Description }}">
    <meta name="twitter:image" content="{{ with .Params.featured_image }}{{ . }}{{ else }}{{ .Site.BaseURL }}images/default-featured.jpg{{ end }}">

    {{ partial "site-style.html" . }}
    {{ partial "site-scripts.html" . }}
    
    {{ block "favicon" . }}
      {{ partialCached "site-favicon.html" . }}
    {{ end }}

    {{/* RSS feeds */}}
    {{ if .OutputFormats.Get "RSS" }}
    {{ with .OutputFormats.Get "RSS" }}
      <link href="{{ .RelPermalink }}" rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" />
      <link href="{{ .RelPermalink }}" rel="feed" type="application/rss+xml" title="{{ $.Site.Title }}" />
      {{ end }}
    {{ end }}
    
    {{/* Hugo Internal Templates */}}
    {{- template "_internal/opengraph.html" . -}}
    {{- template "_internal/schema.html" . -}}
    {{- template "_internal/twitter_cards.html" . -}}

    {{/* Google Analytics 4 */}}
    {{ if and $production $public }}
      {{ if .Site.Params.google_analytics }}
        {{ template "_internal/google_analytics.html" . }}
      {{ end }}
    {{ end }}
    
    {{/* Preload critical resources */}}
    <link rel="preload" href="{{ .Site.BaseURL }}css/main.min.css" as="style">
    <link rel="preload" href="{{ .Site.BaseURL }}js/main.min.js" as="script">
    
    {{/* DNS prefetch for external domains */}}
    <link rel="dns-prefetch" href="//www.google-analytics.com">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    {{ block "head" . }}{{ partial "head-additions.html" . }}{{ end }}
  </head>

  <body class="ma0 {{ $.Param "body_classes"  | default "avenir bg-near-white"}}{{ with getenv "HUGO_ENV" }} {{ . }}{{ end }}">
    {{/* Add reading progress bar for blog posts */}}
    {{ if .IsPage }}
      {{ partial "reading-progress.html" . }}
    {{ end }}

    {{ block "header" . }}{{ partial "site-header.html" .}}{{ end }}
    <main class="pb7" role="main">
      {{ block "main" . }}{{ end }}
    </main>
    {{ block "footer" . }}{{ partialCached "site-footer.html" . }}{{ end }}
    
    {{/* Lazy loading script */}}
    {{ partial "lazy-loading.html" . }}
  </body>
</html>
